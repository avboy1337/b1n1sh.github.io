<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <pre id='log'></pre>  
  <script>
    function mylog(string) {
        var log = document.getElementById('log');
        if (log) {        
            log.innerText += string+'\n';
        }
    }

    function detectTwice() {
      if (window.FaceDetector == undefined) {
        console.error(`Face Detection not supported`);
        return;
      }

      var arr = new Array();

      arr[1] = new FaceDetector();
      arr[2] = new FaceDetector();

      // const faceDetector = new FaceDetector();
      const image = new ImageData(200, 100);

      Object.prototype.__defineGetter__("then", function() {
        mylog("Promise Resolver!");
        setTimeout(()=> { arr[1] = new FaceDetector(); }, 3000);
      });

      arr[1].detect(image)
        .then(faces => { mylog("first"); });

        arr[1].detect(image)
        .then(faces => { mylog("second"); });
    }
    detectTwice();
  </script>
</body>
</html>
